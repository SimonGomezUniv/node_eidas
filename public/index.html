

<!doctype html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EIDAS Photo Demo</title>
    <link  rel="stylesheet"  href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <meta http-equiv="Content-Language" content="en">
</head>
<body>
    <main class="container">
        <h1>EIDAS Photo Demo</h1>
        <p>Scan the QR code with your wallet to get the photo.</p>
        <p>Click the button to launch the wallet.</p>
    
        <button id="wallet">launch Wallet </button>
        <div id="qr-code"></div>
        <div id="photo"></div>
        <div class="'debug" style="display: none;">
            <h2>Debug</h2>
            <input  id="input" id="input" placeholder="Type something..." />
            
            <button onclick="generateQrcode()">generate qrcode </button>
            <button onclick="resetPhoto()">reset Photo</button>
            
        </div>
    </main>
</body>

<script>

    var dns_rp="http://192.168.1.19:3000"
    var nounce="fix_nounce"

    function resetPhoto() {
        fetch('/reset-photo')
            .then(response => response.text())
            .then(html => {
                const photoDiv = document.getElementById('photo');
                photoDiv.innerHTML = html;
            })
            .catch(error => {
                console.error('Error resetting photo:', error);
            });
    }


    fetch('/dns_rp')
        .then(response => response.json())
        .then(data => {
            dns_rp = data.dns_rp;
            qr_code_redirect = `openid4vp://?client_id=my_client_id&request_uri=${dns_rp}/request-object/${nounce}`;
            document.getElementById("wallet").onclick = function() {
                window.open(qr_code_redirect, '_blank');
            };
            document.getElementById("input").value = qr_code_redirect;
            generateQrcode();
        })
        .catch(error => {
            console.error('Error fetching dns_rp:', error);
        });
    

    function generateQrcode() {
        const inputValue = document.getElementById("input").value;
        fetch('/generate-qrcode', {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({ text: inputValue })
        })
        .then(response => response.json())
        .then(data => {
            console.log('QR Code generated:', data);
            
            document.getElementById('qr-code').innerHTML = `<img src="${data.qrCode}" alt="QR Code" />`;
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }


    function fetchPhoto() {
        fetch('/photo')
            .then(response => response.text())
            .then(html => {
                const photoDiv = document.getElementById('photo');
                photoDiv.innerHTML = html;
            })      
    }

    fetchPhoto();
setInterval(fetchPhoto, 2000);
</script>

</html>